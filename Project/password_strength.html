
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Password Strength Analyzer</title>
<link rel="stylesheet" href="strength.css">
</head>
<body>
<div class="container">
<h1>Password Strength Analyzer</h1>

<input type="text" id="check" placeholder="Password will appear here">
<p id="strength">Strength will appear here</p>

<h3>Save to Vault</h3>
<input type="text" id="website" placeholder="Website">
<input type="text" id="username" placeholder="Username">
<textarea id="passwordCopy" rows="1" readonly></textarea><br>
<button id="saveBtn">Save to Vault</button><br>
<a href="view_vault.html"><button>View Vault</button></a>
<a href="index.html"><button>Back to Home</button></a>
</div>

<script>
// ===== Password Analysis =====
function getPasswordFromURL(){return new URLSearchParams(window.location.search).get("pwd")||"";}
function analyzeStrength(password){
    if(password.length>8&&/[A-Z]/.test(password)&&/\d/.test(password)&&/\W/.test(password)) return "Strong";
    else if(password.length>6) return "Medium";
    return "Weak";
}
const passwordInput=document.getElementById("check");
const strengthP=document.getElementById("strength");
const passwordCopy=document.getElementById("passwordCopy");
const passwordFromURL=getPasswordFromURL();
if(passwordFromURL){
    passwordInput.value=passwordFromURL;
    const strength=analyzeStrength(passwordFromURL);
    strengthP.innerText="Strength: "+strength;
    strengthP.className=strength.toLowerCase();
    passwordCopy.value=passwordFromURL;
}
passwordInput.addEventListener("input",function(){
    const pwd=this.value;
    const str=analyzeStrength(pwd);
    strengthP.innerText="Strength: "+str;
    strengthP.className=str.toLowerCase();
    passwordCopy.value=pwd;
});

// ===== Encryption =====
function str2ab(str){return new TextEncoder().encode(str);}
function ab2str(buf){return new TextDecoder().decode(buf);}

// Derive 256-bit key from master password using SHA-256
async function generateKey(password){
    const hash = await crypto.subtle.digest("SHA-256", str2ab(password));
    return await crypto.subtle.importKey("raw", hash, "AES-GCM", true, ["encrypt","decrypt"]);
}

async function encryptData(text,key){
    const iv=crypto.getRandomValues(new Uint8Array(12));
    const cipher=await crypto.subtle.encrypt({name:"AES-GCM",iv:iv},key,str2ab(text));
    return {iv: Array.from(iv), data: Array.from(new Uint8Array(cipher))};
}

// ===== Save Button =====
document.getElementById("saveBtn").addEventListener("click", async ()=>{
    const website=document.getElementById("website").value;
    const username=document.getElementById("username").value;
    const pwd=passwordCopy.value;
    if(!website||!username||!pwd) return alert("Enter all fields!");
    
    const masterPassword=prompt("Enter master password for encryption:");
    if(!masterPassword) return;

    const key=await generateKey(masterPassword);
    const encryptedPwd=await encryptData(pwd,key);

    let vault=JSON.parse(localStorage.getItem("vault")||"[]");
    vault.push({website, username, password: encryptedPwd});
    localStorage.setItem("vault", JSON.stringify(vault));

    alert("Password saved securely!");
    document.getElementById("website").value="";
    document.getElementById("username").value="";
});
</script>
</body>
</html>
